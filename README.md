HW5 ‚Äî Airflow retraining pipeline with conditional deploy and notifications

–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ5 –ø–æ –∫—É—Ä—Å—É ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥¬ª.
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ML-–∫–æ–Ω–≤–µ–π–µ—Ä –≤ Apache Airflow —Å —É—Å–ª–æ–≤–Ω—ã–º –¥–µ–ø–ª–æ–µ–º –º–æ–¥–µ–ª–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ –≤—ã–≤–æ–¥–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω.

üéØ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–û—Å–≤–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ–º–æ–≥–æ ML-–ø–∞–π–ø–ª–∞–π–Ω–∞, –≤–∫–ª—é—á–∞—é—â–µ–≥–æ:

–ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏,

–ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞—á–µ—Å—Ç–≤–∞,

—É—Å–ª–æ–≤–Ω–æ–µ –≤–µ—Ç–≤–ª–µ–Ω–∏–µ (–¥–µ–ø–ª–æ–π / –ø—Ä–æ–ø—É—Å–∫),

—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–≤–æ–¥–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏,

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞.

üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DAG

DAG ml_retrain_pipeline —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á:

train_model ‚Äî –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏.

evaluate_model ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ (–º–µ—Ç—Ä–∏–∫–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ—Ä–æ–≥–æ–º).

decide_deploy ‚Äî –≤–µ—Ç–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∏:

–µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ ‚â• –ø–æ—Ä–æ–≥–∞ ‚Üí deploy_model,

–∏–Ω–∞—á–µ ‚Üí skip_deploy.

deploy_model ‚Äî –¥–µ–ø–ª–æ–π –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω.

notify_success ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –¥–µ–ø–ª–æ–µ.

skip_deploy ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞ –¥–µ–ø–ª–æ—è.

end ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ DAG.

–°—Ö–µ–º–∞:

train_model ‚Üí evaluate_model ‚Üí decide_deploy
                             ‚Ü≥ deploy_model ‚Üí notify_success ‚Üí end
                             ‚Ü≥ skip_deploy ‚Üí end

‚öô –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

Apache Airflow 2.x

PythonOperator, BranchPythonOperator

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

Telegram Bot API –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
MODEL_VERSION	–í–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏
METRIC_VALUE	–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
METRIC_THRESHOLD	–ü–æ—Ä–æ–≥ –∫–∞—á–µ—Å—Ç–≤–∞
TG_TOKEN	Telegram bot token
TG_CHAT	Telegram chat id

–ü—Ä–∏–º–µ—Ä (PowerShell):

$env:MODEL_VERSION="hw5-model"
$env:METRIC_VALUE="0.9"
$env:METRIC_THRESHOLD="0.8"
$env:TG_TOKEN="..."
$env:TG_CHAT="..."

üö¶ –õ–æ–≥–∏–∫–∞ –¥–µ–ø–ª–æ—è

–ï—Å–ª–∏ METRIC_VALUE >= METRIC_THRESHOLD ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–µ–ø–ª–æ–π.

–ò–Ω–∞—á–µ –¥–µ–ø–ª–æ–π –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram:

–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ: hw5-model
metric=0.9 threshold=0.8
deploy_status=success

‚ñ∂ –ó–∞–ø—É—Å–∫

–ü–æ–º–µ—Å—Ç–∏—Ç—å ml_retrain_pipeline.py –≤ –∫–∞—Ç–∞–ª–æ–≥ dags/.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–ó–∞–ø—É—Å—Ç–∏—Ç—å Airflow.

–ó–∞–ø—É—Å—Ç–∏—Ç—å DAG –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–ª–∞–Ω–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ CLI:

airflow dags test ml_retrain_pipeline 2025-12-25
